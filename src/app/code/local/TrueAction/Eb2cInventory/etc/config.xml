<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 *
 * @category    TrueAction
 * @package     TrueAction_Eb2c
 * @copyright   Copyright (c) 2013 True Action (http://www.trueaction.com)
 */
-->
<config>
	<modules>
		<TrueAction_Eb2cInventory>
			<version>1.0.0</version>
		</TrueAction_Eb2cInventory>
	</modules>
	<global>
		<models>
			<eb2cinventory>
				<class>TrueAction_Eb2cInventory_Model</class>
			</eb2cinventory>
			<eb2cinventoryoverride>
				<class>TrueAction_Eb2cInventory_Overrides_Model</class>
			</eb2cinventoryoverride>
			<checkout>
				<rewrite>
					<cart>TrueAction_Eb2cInventory_Overrides_Model_Cart</cart>
				</rewrite>
			</checkout>
			<cataloginventory>
				<rewrite>
					<stock_item>TrueAction_Eb2cInventory_Overrides_Model_Stock_Item</stock_item>
				</rewrite>
			</cataloginventory>
		</models>
		<fieldsets>
			<sales_convert_quote_item>
				<eb2c_reservation_id>
					<to_order_item>*</to_order_item>
				</eb2c_reservation_id>
				<eb2c_reservation_expires>
					<to_order_item>*</to_order_item>
				</eb2c_reservation_expires>
				<eb2c_qty_reserved>
					<to_order_item>*</to_order_item>
				</eb2c_qty_reserved>
				<eb2c_creation_time>
					<to_order_item>*</to_order_item>
				</eb2c_creation_time>
				<eb2c_display>
					<to_order_item>*</to_order_item>
				</eb2c_display>
				<eb2c_delivery_window_from>
					<to_order_item>*</to_order_item>
				</eb2c_delivery_window_from>
				<eb2c_delivery_window_to>
					<to_order_item>*</to_order_item>
				</eb2c_delivery_window_to>
				<eb2c_shipping_window_from>
					<to_order_item>*</to_order_item>
				</eb2c_shipping_window_from>
				<eb2c_shipping_window_to>
					<to_order_item>*</to_order_item>
				</eb2c_shipping_window_to>
				<eb2c_ship_from_address_line1>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_line1>
				<eb2c_ship_from_address_line2>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_line2>
				<eb2c_ship_from_address_line3>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_line3>
				<eb2c_ship_from_address_line4>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_line4>
				<eb2c_ship_from_address_city>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_city>
				<eb2c_ship_from_address_main_division>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_main_division>
				<eb2c_ship_from_address_country_code>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_country_code>
				<eb2c_ship_from_address_postal_code>
					<to_order_item>*</to_order_item>
				</eb2c_ship_from_address_postal_code>
			</sales_convert_quote_item>
		</fieldsets>
		<resources>
			<eb2cinventory_setup>
				<setup>
					<module>TrueAction_Eb2cInventory</module>
				</setup>
			</eb2cinventory_setup>
		</resources>
		<helpers>
			<eb2cinventory>
				<class>TrueAction_Eb2cInventory_Helper</class>
			</eb2cinventory>
		</helpers>
	</global>
	<frontend>
		<routers>
			<trueaction_eb2cinventory>
				<use>standard</use>
				<args>
					<module>TrueAction_Eb2cInventory</module>
					<frontName>eb2c</frontName>
				</args>
			</trueaction_eb2cinventory>
			<checkout>
				<args>
					<modules>
						<TrueAction_Eb2cInventory before="Mage_Checkout">TrueAction_Eb2cInventory_Override_Checkout</TrueAction_Eb2cInventory>
					</modules>
				</args>
			</checkout>
		</routers>
		<events>
			<sales_quote_item_qty_set_after>
				<observers>
					<TrueAction_Eb2cInventory_observer>
						<type>singleton</type>
						<class>TrueAction_Eb2cInventory_Model_Observer</class>
						<method>checkEb2cInventoryQuantity</method>
					</TrueAction_Eb2cInventory_observer>
				</observers>
			</sales_quote_item_qty_set_after>
			<sales_quote_remove_item>
				<observers>
					<TrueAction_Eb2cInventory_observer>
						<type>singleton</type>
						<class>TrueAction_Eb2cInventory_Model_Observer</class>
						<method>rollbackOnRemoveItemInReservedCart</method>
					</TrueAction_Eb2cInventory_observer>
				</observers>
			</sales_quote_remove_item>
			<checkout_controller_onepage_save_shipping_method>
				<observers>
					<TrueAction_Eb2cInventory_observer>
						<type>singleton</type>
						<class>TrueAction_Eb2cInventory_Model_Observer</class>
						<method>processInventoryDetails</method>
					</TrueAction_Eb2cInventory_observer>
				</observers>
			</checkout_controller_onepage_save_shipping_method>
			<eb2c_allocation_onepage_save_order_action_before>
				<observers>
					<TrueAction_Eb2cInventory_observer>
						<type>singleton</type>
						<class>TrueAction_Eb2cInventory_Model_Observer</class>
						<method>processEb2cAllocation</method>
					</TrueAction_Eb2cInventory_observer>
				</observers>
			</eb2c_allocation_onepage_save_order_action_before>
		</events>
	</frontend>
	<crontab>
		<jobs>
			<eb2cinventory_feed_item_inventories>
				<schedule><cron_expr>0 3 * * *</cron_expr></schedule>
				<run>
					<model>eb2cinventory/feed_item_inventories::processFeeds</model>
				</run>
			</eb2cinventory_feed_item_inventories>
		</jobs>
	</crontab>
	<default>
		<eb2c>
			<inventory>
				<developer_mode>1</developer_mode>
				<quantity_api_uri>http://eb2c.rgabriel.mage.tandev.net/eb2c/api/request/QuantityResponseMessage.xml</quantity_api_uri>
				<inventory_detail_uri>http://eb2c.rgabriel.mage.tandev.net/eb2c/api/request/InventoryDetailsResponseMessage.xml</inventory_detail_uri>
				<allocation_uri>http://eb2c.rgabriel.mage.tandev.net/eb2c/api/request/AllocationResponseMessage.xml</allocation_uri>
				<rollback_allocation_uri>http://eb2c.rgabriel.mage.tandev.net/eb2c/api/request/RollbackAllocationResponseMessage.xml</rollback_allocation_uri>
				<allocation_expired>60</allocation_expired>
				<feed_local_path>TrueAction/Eb2c/Feed/Item/Inventories/</feed_local_path>
				<feed_remote_received_path>/Item/Inventories/</feed_remote_received_path>
				<config_path>eb2ccore/general</config_path>
				<feed_event_type>ItemInventories</feed_event_type>
				<feed_header_version>2.3.0</feed_header_version>
			</inventory>
		</eb2c>
	</default>
	<phpunit>
		<suite>
			<modules>
				<TrueAction_Eb2cInventory />
			</modules>
		</suite>
	</phpunit>
</config>
